"use strict";require("core-js/modules/es.object.set-prototype-of.js");require("core-js/modules/es.object.get-prototype-of.js");require("core-js/modules/es.reflect.construct.js");require("core-js/modules/es.symbol.iterator.js");require("core-js/modules/es.array.iterator.js");require("core-js/modules/es.string.iterator.js");require("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;require("core-js/modules/es.array.map.js");require("core-js/modules/es.symbol.to-primitive.js");require("core-js/modules/es.date.to-primitive.js");require("core-js/modules/es.symbol.js");require("core-js/modules/es.symbol.description.js");require("core-js/modules/es.object.to-string.js");require("core-js/modules/es.number.constructor.js");var _react=_interopRequireDefault(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));var _nanoid=require("nanoid");var _classnames=_interopRequireDefault(require("classnames"));var _index=require("../common/index.js");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}var SelectElement=function(_React$Component){_inherits(SelectElement,_React$Component);var _super=_createSuper(SelectElement);function SelectElement(props){var _this;_classCallCheck(this,SelectElement);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"handleFocus",function(){var selectIndex=_this.state.selectIndex;_this.activeIndex(selectIndex);});_defineProperty(_assertThisInitialized(_this),"handleBlur",function(){_this.setState({hasActiveOptions:false});});_defineProperty(_assertThisInitialized(_this),"handleMouseEnter",function(){_this.setState({activeEnter:true});});_defineProperty(_assertThisInitialized(_this),"handleMouseLeave",function(){_this.setState({activeEnter:false});});_defineProperty(_assertThisInitialized(_this),"handleActiveEnterFocus",function(){return true;});_defineProperty(_assertThisInitialized(_this),"handleActiveEnterBlur",function(){_this.getSelectOption().focus();});_defineProperty(_assertThisInitialized(_this),"handleClick",function(event){if((0,_index.isEventClickLike)(event)){_this.getSelectOption().focus();}else{_this.setState({hasActiveOptions:true});}});_defineProperty(_assertThisInitialized(_this),"handleOptionClick",function(index){_this.setState({hasActiveOptions:false});_this.selectIndex(index);_this.getSelectOption().focus();});_defineProperty(_assertThisInitialized(_this),"handleActiveOptionsKeyPress",function(event){if((0,_index.isKeyEnter)(event)||(0,_index.isKeySpace)(event))return;return _this.handleActiveOptionsKeyChar(event);});_defineProperty(_assertThisInitialized(_this),"handleKeyPress",function(event){return _this.handleKeyChar(event);});_defineProperty(_assertThisInitialized(_this),"handleActiveOptionsKeyUp",function(event){return _this.handleActiveOptionsKeyCode(event);});_defineProperty(_assertThisInitialized(_this),"handleActiveOptionsKeyDown",function(){return true;});_defineProperty(_assertThisInitialized(_this),"handleKeyUp",function(event){return _this.handleKeyCode(event);});_defineProperty(_assertThisInitialized(_this),"handleKeyDown",function(){return true;});_defineProperty(_assertThisInitialized(_this),"getOptionRef",function(index){var activeIndex=_this.state.activeIndex;if(index===activeIndex){return _this.activeOption;}});_defineProperty(_assertThisInitialized(_this),"renderOptionDisabled",function(option,index){var optionText=_this.renderOptionText(option,index);var selectIndex=_this.state.selectIndex;return _react.default.createElement("li",{key:index,ref:_this.getOptionRef(index),className:_this.getOptionDisabledClassName(index),role:"option","aria-selected":index===selectIndex},optionText);});_defineProperty(_assertThisInitialized(_this),"renderOptionReadOnly",function(option,index){var optionText=_this.renderOptionText(option,index);var selectIndex=_this.state.selectIndex;return _react.default.createElement("li",{key:index,ref:_this.getOptionRef(index),className:_this.getOptionReadOnlyClassName(index),role:"option","aria-selected":index===selectIndex},optionText);});_defineProperty(_assertThisInitialized(_this),"renderOption",function(option,index){var optionText=_this.renderOptionText(option,index);var selectIndex=_this.state.selectIndex;return _react.default.createElement("li",{key:index,ref:_this.getOptionRef(index),className:_this.getOptionClassName(index),onMouseEnter:function onMouseEnter(){return _this.activeIndex(index);},onMouseLeave:function onMouseLeave(){return _this.activeIndex(index);},onClick:function onClick(){return _this.handleOptionClick(index);},role:"option","aria-selected":index===selectIndex},optionText);});_this.selectOption=_react.default.createRef();_this.options=_react.default.createRef();_this.activeOption=_react.default.createRef();_this.state={id:(0,_nanoid.nanoid)(),selectIndex:(0,_index.getSelectIndex)(props),hasActiveOptions:false,activeEnter:false,activeIndex:0,activeChars:''};return _this;}_createClass(SelectElement,[{key:"upperBound",get:function get(){var n=this.props.options.length;return Math.max(0,n-1);}},{key:"lowerBound",get:function get(){return 0;}},{key:"scrollOptionIntoView",value:function scrollOptionIntoView(element){if(element){var options=this.getOptions();if(options.contains(element)){var clientHeight=options.clientHeight;var offsetHeight=element.offsetHeight,offsetTop=element.offsetTop;var i=clientHeight/2;var j=offsetHeight/2;var n=Math.max(0,offsetTop-i+j);if(n!==options.scrollTop)options.scrollTop=n;}}}},{key:"toLowerBound",value:function toLowerBound(){this.setState({activeIndex:this.lowerBound});}},{key:"toUpperBound",value:function toUpperBound(){this.setState({activeIndex:this.upperBound});}},{key:"handleKeySpace",value:function handleKeySpace(){this.setState({hasActiveOptions:false});var activeIndex=this.state.activeIndex;this.selectIndex(activeIndex);}},{key:"handleKeyEnter",value:function handleKeyEnter(){this.setState({hasActiveOptions:false});var activeIndex=this.state.activeIndex;this.selectIndex(activeIndex);}},{key:"handleKeyEscape",value:function handleKeyEscape(){this.setState({hasActiveOptions:false});}},{key:"handleKeyArrowUp",value:function handleKeyArrowUp(){this.decrementActiveIndex();this.setState({activeChars:''});}},{key:"handleKeyArrowDown",value:function handleKeyArrowDown(){this.incrementActiveIndex();this.setState({activeChars:''});}},{key:"handleActiveOptionsKeyChar",value:function handleActiveOptionsKeyChar(_ref){var keyChar=_ref.charCode;var activeChars=this.state.activeChars;var options=this.props.options;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;if((0,_index.hasExactMatch)(options,chars)){this.setState({activeChars:chars});this.activeIndex((0,_index.getExactMatchIndex)(options,chars));}else{if((0,_index.hasStartMatch)(options,chars)){this.setState({activeChars:chars});this.activeIndex((0,_index.getStartMatchIndex)(options,chars));}else{if((0,_index.hasExactMatch)(options,char)){this.setState({activeChars:char});this.activeIndex((0,_index.getExactMatchIndex)(options,char));}else{if((0,_index.hasStartMatch)(options,char)){this.setState({activeChars:char});this.activeIndex((0,_index.getStartMatchIndex)(options,char));}else{if((0,_index.hasGreaterThanMatch)(options,char)){this.setState({activeChars:''});this.activeIndex((0,_index.getGreaterThanMatchIndex)(options,char));}else{if((0,_index.hasSmallerThanMatch)(options,char)){this.setState({activeChars:''});this.activeIndex((0,_index.getSmallerThanMatchIndex)(options,char));}}}}}}}},{key:"handleKeyChar",value:function handleKeyChar(_ref2){var keyChar=_ref2.charCode;var activeChars=this.state.activeChars;var options=this.props.options;var char=String.fromCharCode(keyChar).toLowerCase();var chars=activeChars+char;if((0,_index.hasExactMatch)(options,chars)){this.setState({activeChars:chars});this.selectIndex((0,_index.getExactMatchIndex)(options,chars));}else{if((0,_index.hasStartMatch)(options,chars)){this.setState({activeChars:chars});this.selectIndex((0,_index.getStartMatchIndex)(options,chars));}else{if((0,_index.hasExactMatch)(options,char)){this.setState({activeChars:char});this.selectIndex((0,_index.getExactMatchIndex)(options,char));}else{if((0,_index.hasStartMatch)(options,char)){this.setState({activeChars:char});this.selectIndex((0,_index.getStartMatchIndex)(options,char));}else{if((0,_index.hasGreaterThanMatch)(options,char)){this.setState({activeChars:''});this.selectIndex((0,_index.getGreaterThanMatchIndex)(options,char));}}}}}}},{key:"handleActiveOptionsKeyCode",value:function handleActiveOptionsKeyCode(event){var keyCode=event.keyCode;switch(keyCode){case 13:this.handleKeyEnter(event);break;case 27:this.handleKeyEscape(event);break;case 32:this.handleKeySpace(event);break;case 38:this.handleKeyArrowUp(event);break;case 40:this.handleKeyArrowDown(event);break;}}},{key:"handleKeyCode",value:function handleKeyCode(_ref3){var keyCode=_ref3.keyCode;if(keyCode===32||keyCode===38||keyCode===40){this.setState({hasActiveOptions:true});}}},{key:"selectIndex",value:function selectIndex(index){var selectIndex=this.state.selectIndex;if(index!==selectIndex){var onChange=this.props.onChange;if(onChange instanceof Function)onChange(index);if('index'in this.props)return;this.setState({selectIndex:index});}}},{key:"activeIndex",value:function activeIndex(index){var activeIndex=this.state.activeIndex;if(index!==activeIndex){this.setState({activeIndex:index});}}},{key:"decrementActiveIndex",value:function decrementActiveIndex(){var activeIndex=this.state.activeIndex;this.activeIndex(Math.max(activeIndex-1,this.lowerBound));}},{key:"incrementActiveIndex",value:function incrementActiveIndex(){var activeIndex=this.state.activeIndex;this.activeIndex(Math.min(activeIndex+1,this.upperBound));}},{key:"getSelectOption",value:function getSelectOption(){return this.selectOption.current;}},{key:"getOptions",value:function getOptions(){return this.options.current;}},{key:"getActiveOption",value:function getActiveOption(){return this.activeOption.current;}},{key:"getOptionsFirstChild",value:function getOptionsFirstChild(){return this.getOptions().firstChild||null;}},{key:"getOptionsLastChild",value:function getOptionsLastChild(){return this.getOptions().lastChild||null;}},{key:"getActiveOptionPreviousSibling",value:function getActiveOptionPreviousSibling(){return this.getActiveOption().previousSibling||null;}},{key:"getActiveOptionNextSibling",value:function getActiveOptionNextSibling(){return this.getActiveOption().nextSibling||null;}},{key:"getSelectedOptionDisabledClassName",value:function getSelectedOptionDisabledClassName(){return'selected-option';}},{key:"getSelectedOptionReadOnlyClassName",value:function getSelectedOptionReadOnlyClassName(index){return'selected-option';}},{key:"getSelectedOptionClassName",value:function getSelectedOptionClassName(){return'selected-option';}},{key:"getSelectedOption",value:function getSelectedOption(){var options=this.props.options;var selectIndex=this.state.selectIndex;return options[selectIndex]||{};}},{key:"getOptionDisabledClassName",value:function getOptionDisabledClassName(index){var selectIndex=this.state.selectIndex;return(0,_classnames.default)({selected:index===selectIndex},'option');}},{key:"getOptionReadOnlyClassName",value:function getOptionReadOnlyClassName(index){var selectIndex=this.state.selectIndex;return(0,_classnames.default)({selected:index===selectIndex},'option');}},{key:"getOptionClassName",value:function getOptionClassName(index){var _this$state=this.state,selectIndex=_this$state.selectIndex,activeIndex=_this$state.activeIndex;return(0,_classnames.default)({selected:index===selectIndex},'option',{active:index===activeIndex});}},{key:"getOptionsClassName",value:function getOptionsClassName(){var hasActiveOptions=this.state.hasActiveOptions;return(0,_classnames.default)('options',{active:hasActiveOptions});}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(props,state){if(props!==this.props)return true;return state.selectIndex!==this.state.selectIndex||state.hasActiveOptions!==this.state.hasActiveOptions||state.activeEnter!==this.state.activeEnter||state.activeIndex!==this.state.activeIndex;}},{key:"renderSelectedOptionText",value:function renderSelectedOptionText(_ref4){var text=_ref4.text;return(0,_index.toOptionText)(text);}},{key:"renderSelectedOptionDisabled",value:function renderSelectedOptionDisabled(){var children=this.props.children;return _react.default.createElement("div",{ref:this.selectOption,className:this.getSelectedOptionDisabledClassName()},children||this.renderSelectedOptionText(this.getSelectedOption()));}},{key:"renderSelectedOptionReadOnly",value:function renderSelectedOptionReadOnly(){var children=this.props.children;return _react.default.createElement("div",{ref:this.selectOption,className:this.getSelectedOptionReadOnlyClassName()},children||this.renderSelectedOptionText(this.getSelectedOption()));}},{key:"renderSelectedOption",value:function renderSelectedOption(){var _this$props=this.props,accessKey=_this$props.accessKey,tabIndex=_this$props.tabIndex,children=_this$props.children;var _this$state2=this.state,activeEnter=_this$state2.activeEnter,hasActiveOptions=_this$state2.hasActiveOptions;return _react.default.createElement("div",{ref:this.selectOption,accessKey:accessKey,tabIndex:tabIndex,className:this.getSelectedOptionClassName(),onFocus:activeEnter?this.handleActiveEnterFocus:this.handleFocus,onBlur:activeEnter?this.handleActiveEnterBlur:this.handleBlur,onClick:this.handleClick,onKeyPress:hasActiveOptions?this.handleActiveOptionsKeyPress:this.handleKeyPress,onKeyUp:hasActiveOptions?this.handleActiveOptionsKeyUp:this.handleKeyUp,onKeyDown:hasActiveOptions?this.handleActiveOptionsKeyDown:this.handleKeyDown},children||this.renderSelectedOptionText(this.getSelectedOption()));}},{key:"renderOptionText",value:function renderOptionText(_ref5){var text=_ref5.text;return(0,_index.toOptionText)(text);}},{key:"renderOptionsDisabled",value:function renderOptionsDisabled(){var options=this.props.options;if(options.length){var id=this.state.id;return _react.default.createElement("ul",{ref:this.options,className:"options",role:"listbox","aria-hidden":true,id:id},options.map(this.renderOptionDisabled));}}},{key:"renderOptionsReadOnly",value:function renderOptionsReadOnly(){var options=this.props.options;if(options.length){var id=this.state.id;return _react.default.createElement("ul",{ref:this.options,className:"options",role:"listbox","aria-hidden":true,id:id},options.map(this.renderOptionReadOnly));}}},{key:"renderOptions",value:function renderOptions(){var options=this.props.options;if(options.length){var _this$state3=this.state,hasActiveOptions=_this$state3.hasActiveOptions,id=_this$state3.id;return _react.default.createElement("ul",{ref:this.options,className:this.getOptionsClassName(),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,role:"listbox","aria-hidden":!hasActiveOptions,id:id},options.map(this.renderOption));}}},{key:"renderDisabled",value:function renderDisabled(){var id=this.state.id;return _react.default.createElement("div",{className:"react-select-element disabled","aria-expanded":false,"aria-haspopup":"listbox","aria-controls":id},this.renderSelectedOptionDisabled(),this.renderOptionsDisabled());}},{key:"renderReadOnly",value:function renderReadOnly(){var id=this.state.id;return _react.default.createElement("div",{className:"react-select-element readonly","aria-expanded":false,"aria-haspopup":"listbox","aria-controls":id},this.renderSelectedOptionReadOnly(),this.renderOptionsReadOnly());}},{key:"render",value:function render(){var disabled=this.props.disabled;if(disabled){return this.renderDisabled();}var readOnly=this.props.readOnly;if(readOnly){return this.renderReadOnly();}var _this$state4=this.state,hasActiveOptions=_this$state4.hasActiveOptions,id=_this$state4.id;return _react.default.createElement("div",{className:"react-select-element","aria-expanded":hasActiveOptions,"aria-haspopup":"listbox","aria-controls":id},this.renderSelectedOption(),this.renderOptions());}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){return'index'in props?{selectIndex:(0,_index.getSelectIndex)(props)}:null;}}]);return SelectElement;}(_react.default.Component);exports.default=SelectElement;SelectElement.propTypes={defaultIndex:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.string]),index:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.string]),tabIndex:_propTypes.default.number,accessKey:_propTypes.default.string,options:_propTypes.default.arrayOf(_propTypes.default.shape({text:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.string,_propTypes.default.bool])})),onChange:_propTypes.default.func,disabled:_propTypes.default.bool,readOnly:_propTypes.default.bool,children:_propTypes.default.node};SelectElement.defaultProps={defaultIndex:0,tabIndex:0,options:[],disabled:false,readOnly:false};